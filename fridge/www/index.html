<!doctype html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <title>Lednice</title>
    <meta name="viewport" content="width=device-width, user-scalable=false;">
</head>
    
<body>

    <div id="frame">

        <h1>Lednice</h1>

        <div class="box e door">
            <label>Dveře</label>
            <span class="value">
                <var id="D">Zavřeno</var>
            </span>
        </div>

        <div class="box a">
            <label>Uvnitř</label>
            <span class="value">
                <var id="i">4,25</var>
                <span>°C</span>
            </span>
        </div>

        <div class="box b">
            <label id="Aname">Pivo</label>
            <span class="value">
                <var id="A">5,25</var>
                <span>°C</span>
            </span>
        </div>

        <div class="box b">
            <label id="Bname">Kofola</label>
            <span class="value">
                <var id="B">5,25</var>
                <span>°C</span>
            </span>
        </div>

        <div class="box d">
            <label>Venku</label>
            <span class="value">
                <var id="V">4,25</var>
                <span>°C</span>
            </span>
        </div>

        <div class="box c">
            <label>Peltier</label>
            <span class="value">
                <var id="P">5,25</var>
                <span>°C</span>
            </span>
        </div>

        <div class="box f">
            <label>Zdroj</label>
            <span class="value">
                <var id="Z">5,25</var>
                <span>°C</span>
            </span>
        </div>

        <div class="time">
            <span id="timestamp">125</span>
        </div>

    </div>

    <script type="text/javascript">

    function update(data)
    {
        $("i").innerHTML = data.i;
        $("A").innerHTML = data.A;
        $("B").innerHTML = data.B;
        $("P").innerHTML = data.P;
        $("V").innerHTML = data.V;
        $("Z").innerHTML = data.Z;

        if (data.aname)
        {
            $("Aname").innerHTML = data.aname;
        }

        if (data.bname)
        {
            $("Bname").innerHTML = data.bname;
        }
        
        if (data.D == 0)
        {
            $("D").innerHTML = "Zavřeno";
        }
        else
        {
            $("D").innerHTML = "Otevřeno";
        }   

        $("timestamp").innerHTML = data.time;
    }

    function $(id)
    {
        return document.getElementById(id);
    }


    //setInterval(update, 1000);
    update({
        i: 11.45,
        A: 12.45,
        B: 13.45,
        P: 14.45,
        V: 15.45,
        Z: 16.45,
        D: 0
    });


    var lastUpdate = +new Date();

    function process(data) 
    {



        data = JSON.parse(data);

        if (!data.value) return;

        update(data.value);
        lastUpdate = +new Date();
        setTimeout(send, 333);
    }

    function send()
    {
        var script = document.createElement("script");
        script.src = "/data/get?jsonp=process";
        document.body.appendChild(script);
        document.body.removeChild(script);
    }

    setInterval(function () {
        if (lastUpdate - new Date() > 5000)
        {
            send();
        }
    })

    send();

    </script>

</body>
</html>
